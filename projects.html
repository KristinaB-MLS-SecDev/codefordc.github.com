---
layout: default
title: Projects
---

<div class="container">

	<div class="col-lg-1"></div>
	<div class="col-lg-10">
    	<div class="col-lg-12 starter-template">
			<h1>Our Projects</h1>
			<p class="lead">Code for DC helps people collaborate on projects to help the community. Whether you're a coder or an activist, a public servant or a designer, browse below and you're bound to find one that needs you!</p>
		</div>
		<div id="sort" class="btn btn-default">Sort!</div>
		<div id="sortbox" class="hidden">
			<div class="group">
				<label>Sort:</label>
				<div class="btn btn-default sort" data-sort="random">Randomize</div>
				<div class="btn btn-default sort" data-sort="created:asc">Age</div>
				<div class="btn btn-default sort" data-sort="updated:dec">Latest commit</div>
				<div class="btn btn-default sort" data-sort="lines:dec">Lines of code</div>
				<div class="btn btn-default sort" data-sort="forks:dec">Forks</div>
				<div class="btn btn-default sort" data-sort="stars:dec">Stars</div>
			</div>
			<div class="group">
				<div class="group category-list">
					<label>Categories:</label>
				</div>
				<div class="group languages">
					<label>Languages:</label>
				</div>
				<div class="group main-languages">
					<label>Main L<a href="#"></a>nguage:</label>
				</div>
				<div class="btn btn-default filter" data-filter="all">Show All</div>
			</div>
		</div>
		<div id='submit-project'>
			<form class="form-inline" role="form">
				<div class="form-group">
					<label class="sr-only" for="submitrepo">Submit a Project</label>
					<input type="url" class="form-control" id="submitrepo" placeholder="Github repo URL">
				</div>
				<button type="submit" class="btn btn-default" id="reposubmit">Submit!</button>
			</form>

		</div>
		<div class="col-lg-12">
			<div id="project-list">
				<!-- populated by js -->
			</div>
		</div>
	</div>
	<div class="col-lg-1"></div>

	<div style="display: none"> <!-- template for a project -->
		<div id="project-template" class="project mix">
			<div class="row">
				<div class="col-sm-12 title">
					<h2><img class='img-rounded thumbnail hidden' height='50' width='50'><span class="name"></span></h2>
					<p class="homepage hidden"><a>Website</a></p>

				</div>
			</div>
			<div class="row">
				<div class="col-sm-5">
					<p class="github-repo"><i class="fa fa-github-alt"></i> <a class="repo-link">github repository</a></p>
					<p class="description"></p>
					<div class="row">
						<p class="col-sm-4 started"><strong>Born</strong><br/> <span></span></p>
						<p class="col-sm-4 status hidden"><strong>Status</strong><br/> <span></span></p>
						<p class="col-sm-4 lines"><strong>Lines of Code</strong><br/> <span></span></p>
					</div>
					<div class="row">
						<p class="col-sm-12 language"><strong>Language(s)</strong><br/> <span></span></p>
					</div>
					<p class="governmentPartner hidden"><strong>Government Partner</strong><br/> <span></span></p>
					<p class="communityPartner hidden"><strong>Community Partner</strong><br/> <span></span></p>
					<p class="politicalEntity hidden"><strong>Relevant to</strong><br/> <span></span></p>
					<p class="contact">
						<a class='btn btn-info btn-sm email hidden' role='button' title="Email"><i class='fa fa-envelope fa-lg'></i></a>
						<a class='btn btn-info btn-sm twitter hidden' role='button' title="Tweet Us"><i class='fa fa-twitter fa-lg'></i></a>
					</p>
					<div class="categories"> </div>
				</div>
				<div class="col-sm-4">
					<h4><strong>Activity</strong></h4>
					<div class="activity">
						<div></div>
					</div>
					<div class="contributors hidden">
						<strong>Contributors</strong>
						<div> </div>
					</div>
				</div>
				<div class="col-sm-3">
					<h4><strong>Get Involved</strong></h4>
					<p class="issues"><a class='btn btn-info' role='button'></a></p>
					<div class="needs hidden">
						<strong>Needs</strong>
						<div> </div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div><!-- /.container -->

{% include _global_js.html %}
<script src="assets/js/moment.min.js"></script>
<script src="assets/js/d3.min.js"></script>
<script src="assets/js/jquery.mixitup.min.js"></script>
<script type="text/javascript">

// Arrays for collecting overall data to sort with MixItUp
l = [];
ml = [];
cat = []

// Function to turn multi-word strings into class-friendly formats
function classify(str) {
    x = str.replace(/\w\S*/g, function(txt) {
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
    });
	x = x.replace(/ /g,"-");
	return x
}

// Load the civic.json file and get working
// This code is based on the projects page at https://github.com/open-city/open-gov-hack-night
window.projects = function(data){
	var projects = data;

	// Sort projects by most recently updated
	projects.sort(function(a,b) {return new Date(b.pushed_at) - new Date(a.pushed_at)})

	// Begin iterating over the JSON file
	$.each(projects, function(i,info){

		// Insert the information into the site's HTML
		var project = $('#project-template').clone();
		project.prop('id', 'project'+i);
		$("#project-list").append(project);

		// Get info for the project, starting with Github info that always exists
		var name = info["name"];
		var created = moment(info["created_at"]).fromNow();
		project.attr("data-created", info["created_at"]);
		var updated = moment(info["pushed_at"]).fromNow();
		project.attr("data-updated", info["pushed_at"]);
		var issues = info["open_issues"];
		var repo_link = info["html_url"];
		project.attr("data-forks",info["forks"]);
		project.attr("data-stars",info["watchers"]);
		if (info["main_language"] == null){
			info["main_language"] = "Text";
		}
		project.addClass("main-"+info["main_language"])

		// Calculate language usage
		var language = info["main_language"];
		var total = 0;
		var languages = "";
		$.each(info["languages"], function(i,lang){
			total += lang[1];
			project.addClass(lang[0]);
			if ($.inArray(lang[0], l) == -1) {
				l.push(lang[0]);
			}
		});
		$.each(info["languages"], function(i,lang){
			languages += lang[0]+": "+Math.ceil(100*(lang[1]/total))+"% | ";
		});
		languages = languages.substring(0, languages.length - 3);
		project.attr("data-lines",total);
		if (languages.length==0){
			languages = "Text: 100%";
		}
		if ($.inArray(info["main_language"],ml) == -1) {
			ml.push(info["main_language"]);
		}

		project.find("h2 span.name").text(name);
//		project.find("h2 a").attr('href', repo_link);

		if (info["civic_json"] && info["civic_json"]["thumbnailUrl"]){
			project.find(".thumbnail").removeClass("hidden")
			.attr("src", info["civic_json"]["thumbnailUrl"]);
		//	project.find("h2 span.name").css("border-bottom","4px solid black");
		}

		if (info["civic_json"] && info["civic_json"]["contact"]["email"])
			project.find(".contact a.email").removeClass('hidden')
				.attr('href', 'mailto:' + info["civic_json"]["contact"]["email"]);

		if (info["civic_json"] && info["civic_json"]["contact"]["twitter"])
			project.find(".contact a.twitter").removeClass('hidden')
				.attr('href', 'http://twitter.com/' + info["civic_json"]["contact"]["twitter"].slice(1));

		if (info["homepage"])
			project.find(".homepage").removeClass('hidden')
				.find('a').attr('href', info["homepage"]).text(info["homepage"]);

		project.find(".github-repo").removeClass('hidden')
			.find('a.repo-link').attr('href', repo_link).text("Github repository >");

		if (info["civic_json"] && info["civic_json"]["communityPartner"]){
			var compartner = ""
			$.each(info["civic_json"]["communityPartner"], function(k,v){
				compartner += "<a href='"+v+"'>"+k+"</a>";
			});
			if (compartner.length > 0){
			project.find(".communityPartner").removeClass('hidden').
				find("span").html(compartner);
			}
		}

		if (info["civic_json"] && info["civic_json"]["governmentPartner"]){
			var govpartner = ""
			$.each(info["civic_json"]["governmentPartner"], function(k,v){
				govpartner += "<a href='"+v+"'>"+k+"</a>"
			});
			if (govpartner.length > 0){
			project.find(".governmentPartner").removeClass('hidden').
				find("span").html(govpartner);
			}
		}

		if (info["civic_json"] && info["civic_json"]["politicalEntity"]){
			var polentity = ""
			$.each(info["civic_json"]["politicalEntity"], function(k,v){
				polentity += "<a href='"+v+"'>"+k+"</a>"
			});
			if (polentity.length > 0){
			project.find(".politicalEntity").removeClass('hidden').
				find("span").html(polentity);
			}
		}

		project.find('.description').text(info["description"]);

		if (info["civic_json"] && info["civic_json"]["needs"]){
			project.find('.needs').removeClass("hidden");
			$.each(info["civic_json"]["needs"], function(k,v){
				project.find('.needs div').append(
					$("<button class='btn btn-sm btn-success need'></button>").text(v["need"])
				);
			});
		}

		$.each(info["contributors"], function(k,v){
			project.find('.contributors').removeClass('hidden'); // important on first iteration only
			var c = $("<a><img class='' height='36' width='36'></a>");
			c.attr('href', v["link"]);
			c.find('img').attr('src', v["avatar_url"]);
			project.find('.contributors div').append(c);
		});

		project.find('.started span').text(created);

		project.find('.lines span').html(total);

		project.find('.language span').html(languages);

		if (info["civic_json"] && info["civic_json"]["status"])
			project.find('.status').removeClass("hidden").find("span").text(info["civic_json"]["status"]);

		project.find('.issues a').attr('href', repo_link+'/issues');
		project.find('.issues a').text(issues ? (issues+" Issues Need Help") : "Submit an Idea");

		if (info["civic_json"] && info["civic_json"]["categories"]){
			$.each(info["civic_json"]["categories"], function(k,v){
				project.find('.categories').append($("<p><button class='btn btn-sm btn-warning category'></button></p>").find('button').text(v['category']))
				c = classify(v['category'])
				project.addClass("category-"+c);
				if ($.inArray(c,cat)==-1){
					cat.push(c);
				}
			})
		}

		// Create a graph of the Github repo's commit history using D3.js, based on https://gist.github.com/ashleybot/1842440
		// This is done after everything else because it requires a HTML element on which to operate

		// First, scale the repo activity to make graphs consistent
		var scaled = [];
		$.each(info["activity"],function(i,n){
			scaled.push(n * 100/Math.max.apply(null, info["activity"]));
		})

		var w = $("#project-list").width() / 156,
			h = 90;

		// Create the chart's SVG in the DOM
		var chart = d3.select("#project"+i+" .activity").append("svg")
			.attr("class", "chart")
			.attr("width", w * 52)
			.attr("height", h);

		chart.append("rect")
    		.attr("width", "100%")
    		.attr("height", "100%")
    		.attr("fill", "#ededed");

		var x = d3.scale.linear()
			.domain([0, 1])
			.range([0, w]);

		var y = d3.scale.linear()
			.domain([0, 100])
			.range([0, h]);

		// Make the actual graph
		chart.selectAll("rect")
			.data(scaled)
		.enter().append("rect")
			.attr("x", function(d, i) { return x(i) - .5; })
			.attr("y", function(d) { return h - y(d) - .5; })
			.attr("width", w / 2)
			.attr("height", function(d) { return y(d); } )
			.attr("fill", "#9E9E9E");

		// Put a border around the graph

	});

	// Create filter options for languages
	l.sort();
	$.each(l, function(i,l){
		$('.languages').append('<div class="btn btn-default filter" data-filter=".'+l+'">'+l+'</div>');
	});
	ml.sort();
	$.each(ml, function(i,l){
		$('.main-languages').append('<div class="btn btn-default filter" data-filter=".main-'+l+'">'+l+'</div>');
	});
	cat.sort();
	$.each(cat, function(i,l){
		$('.category-list').append('<div class="btn btn-default filter" data-filter=".category-'+l+'">'+l.split('-').join(' ')+'</div>');
	});
};

// Make list sortable

$(function(){

	// Instantiate MixItUp:

	$('#project-list').mixItUp({
		animation: {
			enable: false
		},
		layout: {
			display: 'block'
		},
		callbacks: {
			onMixLoad: function(){
				$(this).mixItUp('setOptions', {
					animation: {
						enable: true
					},
				});
			}
		}
	});
});

$("#sort").click(function(){
	$(this).hide();
	$("#sortbox").removeClass("hidden");
})

// New repo submission

$('#reposubmit').click(function(){

	$.post(
		"https://codefordc.slack.com/services/hooks/incoming-webhook?token=FoZHyRwfoVaDse8JLofAQa9B",
		JSON.stringify({'text':'new repo: '+$("#submitrepo").val(),'username':'Project Tracker','icon_emoji':':rotating_light:'})
	).success(function(){
		$('#submitrepo').val('');
	});

	return false;
});

</script>
<script src="https://rawgit.com/codefordc/files/master/projects.js"></script>
